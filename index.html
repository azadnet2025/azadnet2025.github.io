<!DOCTYPE html>
<html lang="fa">
<head>
    <!-- متا تگ‌ها و استایل‌ها بدون تغییر باقی می‌مانند -->
    <style>
        /* استایل‌های قبلی بدون تغییر */
        @media (max-width: 768px) {
            .nav-menu {
                width: 100%;
                padding: 10px;
                position: fixed;
                top: 0;
                right: -100%; /* منو همیشه از راست باز و بسته می‌شود */
                height: 100vh;
                transition: right 0.3s ease; /* فقط right تغییر می‌کند */
                justify-content: flex-start;
            }

            .nav-menu.active {
                right: 0; /* منو همیشه از راست ظاهر می‌شود */
            }

            /* حذف تنظیمات left برای زبان‌های LTR */
            [lang="en"] .nav-menu, [lang="zh"] .nav-menu, [lang="ru"] .nav-menu, [lang="tr"] .nav-menu {
                right: -100%; /* در حالت مخفی همیشه از راست */
            }

            [lang="en"] .nav-menu.active, [lang="zh"] .nav-menu.active, [lang="ru"] .nav-menu.active, [lang="tr"] .nav-menu.active {
                right: 0; /* در حالت فعال همیشه از راست */
            }

            /* تنظیم همبرگر برای زبان‌های LTR */
            [lang="en"] .hamburger, [lang="zh"] .hamburger, [lang="ru"] .hamburger, [lang="tr"] .hamburger {
                right: 10px; /* همبرگر همیشه در سمت راست */
                left: auto;
            }
        }
    </style>
</head>
<body>
    <!-- ساختار HTML بدون تغییر -->
    <script>
        const contents = document.querySelectorAll('.content'),
              spans = document.querySelectorAll('.text-content span'),
              links = document.querySelectorAll('.nav-menu a');
        let blogPostsCache = null;

        function showSection(id) {
            const section = document.getElementById(id);
            if (!section) {
                console.warn(`بخش با شناسه ${id} پیدا نشد!`);
                return;
            }
            contents.forEach(content => content.classList.remove('active'));
            section.classList.add('active');
            links.forEach(link => link.removeAttribute('aria-current'));
            const activeLink = document.querySelector(`a[href="#${id}"]`);
            activeLink.setAttribute('aria-current', 'page');
            window.location.hash = id;
            updateContent();

            // بستن منو در نسخه موبایل پس از انتخاب گزینه
            if (window.innerWidth <= 768) {
                const navMenu = document.querySelector('.nav-menu');
                navMenu.classList.remove('active');
            }
        }

        async function changeLanguage(lang) {
            document.documentElement.lang = lang;
            localStorage.setItem('selectedLanguage', lang); // ذخیره زبان در localStorage
            updateContent();
            updateNavMenu(lang);
            await updateSectionTitles(lang);
            if (document.getElementById('blog').classList.contains('active')) {
                loadBlogPosts();
            }
        }

        function updateNavMenu(lang) {
            links.forEach(link => {
                const text = link.getAttribute(`data-lang-${lang}`);
                if (text) link.textContent = text;
            });
        }

        function updateContent() {
            const currentLang = document.documentElement.lang;
            spans.forEach(span => {
                span.style.display = span.lang === currentLang ? 'block' : 'none';
            });
        }

        async function updateSectionTitles(lang) {
            const translations = {
                'welcome': {
                    'fa': 'خوش آمدید',
                    'en': 'Welcome',
                    'ar': 'مرحبًا',
                    'zh': '欢迎',
                    'ru': 'Добро пожаловать',
                    'tr': 'Hoş Geldiniz'
                },
                'rescue': {
                    'fa': 'پکیج نجات',
                    'en': 'Rescue Package',
                    'ar': 'باقة الإنقاذ',
                    'zh': '救援包',
                    'ru': 'Пакет спасения',
                    'tr': 'Kurtarma Paketi'
                }
            };

            const welcomeText = document.getElementById('welcome-text');
            const rescueText = document.getElementById('rescue-text');

            if (lang !== 'fa') {
                welcomeText.textContent = await translateText(translations['welcome']['fa'], 'fa', lang) || translations['welcome'][lang];
                rescueText.textContent = await translateText(translations['rescue']['fa'], 'fa', lang) || translations['rescue'][lang];
            } else {
                welcomeText.textContent = translations['welcome']['fa'];
                rescueText.textContent = translations['rescue']['fa'];
            }
        }

        function toggleMenu() {
            const navMenu = document.querySelector('.nav-menu');
            const contentWrapper = document.querySelector('.content-wrapper');
            if (window.innerWidth > 768) {
                navMenu.classList.toggle('hidden');
                contentWrapper.classList.toggle('expanded');
            } else {
                navMenu.classList.toggle('active');
            }
        }

        function loadSectionFromHash() {
            const hash = window.location.hash.substring(1);
            const validSections = ['home', 'rescue', 'blog'];
            if (hash && validSections.includes(hash)) {
                showSection(hash);
                if (hash === 'blog') loadBlogPosts();
            } else {
                showSection('home');
            }
        }

        // تابع برای بارگذاری زبان ذخیره‌شده
        function loadSavedLanguage() {
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'fa';
            document.documentElement.lang = savedLanguage;
            document.querySelector('.language-menu select').value = savedLanguage;
            changeLanguage(savedLanguage);
        }

        window.onload = function() {
            loadSavedTheme(); // بارگذاری تم ذخیره‌شده
            loadSavedLanguage(); // بارگذاری زبان ذخیره‌شده
            loadSectionFromHash();
        };

        window.onhashchange = loadSectionFromHash;

        // سایر توابع (loadBlogPosts, translateText, changeTheme) بدون تغییر باقی می‌مانند
    </script>
</body>
</html>
