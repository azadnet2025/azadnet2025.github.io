<!DOCTYPE html>
<html lang="fa">
<head>
    <!-- متا تگ‌ها بدون تغییر -->
    <style>
        /* استایل‌های قبلی بدون تغییر تا اینجا */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Estedad', Arial, sans-serif;
            font-weight: 300;
            direction: rtl;
            height: 100vh;
            overflow-x: hidden;
            background-color: var(--bg-color, #ffffff);
            color: var(--text-color, #333);
        }
        [lang="en"] body, [lang="zh"] body, [lang="ru"] body, [lang="tr"] body {
            direction: ltr;
        }
        [lang="ar"] body {
            direction: rtl;
        }
        :root {
            --bg-color: #ffffff;
            --text-color: #333;
            --nav-bg: #d3d3d3;
            --link-color: #007bff;
        }
        .container {
            display: flex;
            min-height: 100vh;
            position: relative;
            flex-direction: row;
        }
        .nav-menu {
            width: 200px;
            padding: 20px;
            background-color: var(--nav-bg);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 1000;
        }
        [lang="en"] .nav-menu, [lang="zh"] .nav-menu, [lang="ru"] .nav-menu, [lang="tr"] .nav-menu {
            right: auto;
            left: 0;
            direction: ltr;
        }
        .nav-menu.hidden {
            right: -200px;
        }
        [lang="en"] .nav-menu.hidden, [lang="zh"] .nav-menu.hidden, [lang="ru"] .nav-menu.hidden, [lang="tr"] .nav-menu.hidden {
            left: -200px;
        }
        .nav-menu .site-logo {
            display: block;
            width: 100px;
            height: auto;
            margin: 20px auto;
            user-select: none;
            will-change: transform;
        }
        .nav-menu .site-logo:hover {
            animation: dizzyAnimation 1.67s linear 1;
        }
        @keyframes dizzyAnimation {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        .nav-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        .nav-menu ul li {
            margin: 15px 0;
        }
        .nav-menu ul li a {
            text-decoration: none;
            color: var(--text-color);
            font-size: 18px;
            font-family: 'Estedad', Arial, sans-serif;
            font-weight: 700;
            cursor: pointer;
        }
        .nav-menu ul li a:hover {
            color: var(--link-color);
        }
        .language-menu, .theme-menu {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-top: 10px;
            backdrop-filter: blur(10px);
        }
        .language-menu select, .theme-menu select {
            width: 100%;
            padding: 8px;
            background: transparent;
            border: none;
            font-size: 16px;
            font-family: 'Estedad', Arial, sans-serif;
            font-weight: 300;
            color: var(--text-color);
            cursor: pointer;
        }
        .content-wrapper {
            flex-grow: 1;
            margin-right: 200px;
            transition: margin 0.3s ease;
        }
        [lang="en"] .content-wrapper, [lang="zh"] .content-wrapper, [lang="ru"] .content-wrapper, [lang="tr"] .content-wrapper {
            margin-right: 0;
            margin-left: 200px;
        }
        .content-wrapper.expanded {
            margin-right: 0;
            margin-left: 0;
        }
        .content {
            flex-grow: 1;
            padding: 20px;
            display: none;
            justify-content: center;
            align-items: center;
            min-height: auto;
            overflow-y: auto;
            max-height: 100vh;
        }
        .content.active {
            display: flex;
        }
        #blog.content.active {
            padding-top: 80px;
        }
        .text-section {
            padding: 20px;
            max-width: 600px;
            text-align: justify;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .text-content span {
            font-family: 'Estedad', Arial, sans-serif;
            font-weight: 300;
        }
        .text-content strong {
            font-weight: 700;
        }
        /* بقیه استایل‌ها بدون تغییر */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                min-height: auto;
            }
            .nav-menu {
                width: 100%;
                padding: 10px;
                position: fixed;
                top: 0;
                right: -100%;
                height: 100vh;
                transition: right 0.3s ease;
                justify-content: flex-start;
            }
            .nav-menu.active {
                right: 0;
            }
            [lang="en"] .nav-menu, [lang="zh"] .nav-menu, [lang="ru"] .nav-menu, [lang="tr"] .nav-menu {
                right: -100%;
                left: auto;
            }
            [lang="en"] .nav-menu.active, [lang="zh"] .nav-menu.active, [lang="ru"] .nav-menu.active, [lang="tr"] .nav-menu.active {
                right: 0;
                left: auto;
            }
            .nav-menu .site-logo {
                width: 80px;
                margin: 20px auto;
            }
            .nav-menu ul {
                flex-direction: column;
                justify-content: flex-start;
                margin-top: 60px;
                margin-bottom: 0;
            }
            .nav-menu ul li {
                margin: 10px 0;
            }
            .language-menu, .theme-menu {
                margin-top: 10px;
                padding: 6px;
            }
            .language-menu select, .theme-menu select {
                font-size: 12px;
                padding: 4px;
            }
            .content-wrapper {
                margin: 0; /* حاشیه صفر برای همه جهت‌گیری‌ها */
            }
            [lang="en"] .content-wrapper, [lang="zh"] .content-wrapper, [lang="ru"] .content-wrapper, [lang="tr"] .content-wrapper {
                margin: 0; /* اطمینان از حذف حاشیه در LTR */
            }
            .content {
                padding: 10px;
                max-height: none;
                margin-top: 60px;
                width: 100%; /* اطمینان از پر شدن عرض صفحه */
                justify-content: center; /* مرکز کردن محتوا در همه حالت‌ها */
            }
            #blog.content.active {
                padding-top: 60px;
            }
            .text-section {
                padding: 10px;
                text-align: justify; /* حفظ توجیه متن */
                margin: 0 auto; /* مرکز کردن در محور افقی */
            }
            #blog-posts {
                padding: 10px;
            }
            .hamburger {
                right: 10px;
                left: auto;
            }
            [lang="en"] .hamburger, [lang="zh"] .hamburger, [lang="ru"] .hamburger, [lang="tr"] .hamburger {
                right: auto;
                left: 10px; /* تغییر موقعیت همبرگر در LTR */
            }
            .accordion.active .accordion-content {
                max-height: 200px;
            }
        }
        @media (min-width: 769px) {
            .text-section {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <!-- محتوای HTML بدون تغییر -->
    <script>
        // اسکریپت بدون تغییر
        const contents = document.querySelectorAll('.content'),
              spans = document.querySelectorAll('span[lang]'),
              links = document.querySelectorAll('.nav-menu a');
        let blogPostsCache = null;

        function showSection(id) {
            const section = document.getElementById(id);
            if (!section) {
                console.warn(`بخش با شناسه ${id} پیدا نشد!`);
                return;
            }
            contents.forEach(content => content.classList.remove('active'));
            section.classList.add('active');
            links.forEach(link => link.removeAttribute('aria-current'));
            const activeLink = document.querySelector(`a[href="#${id}"]`);
            activeLink.setAttribute('aria-current', 'page');
            window.location.hash = id;
            localStorage.setItem('activeSection', id);
            updateContent();
        }

        async function changeLanguage(lang) {
            document.documentElement.lang = lang;
            localStorage.setItem('selectedLanguage', lang);
            updateContent();
            updateNavMenu(lang);
            if (document.getElementById('blog').classList.contains('active')) {
                loadBlogPosts();
            }
        }

        function updateNavMenu(lang) {
            links.forEach(link => {
                const text = link.getAttribute(`data-lang-${lang}`);
                if (text) {
                    link.querySelector(`span[lang="${lang}"]`).textContent = text;
                }
            });
        }

        function updateContent() {
            const currentLang = document.documentElement.lang || 'fa';
            spans.forEach(span => {
                span.style.display = span.lang === currentLang ? 'inline' : 'none';
            });
        }

        function toggleMenu() {
            const navMenu = document.querySelector('.nav-menu');
            const contentWrapper = document.querySelector('.content-wrapper');
            if (window.innerWidth > 768) {
                navMenu.classList.toggle('hidden');
                contentWrapper.classList.toggle('expanded');
            } else {
                navMenu.classList.toggle('active');
            }
        }

        function loadSectionFromHash() {
            const hash = window.location.hash.substring(1);
            const validSections = ['home', 'rescue', 'blog'];
            if (hash && validSections.includes(hash)) {
                showSection(hash);
                if (hash === 'blog') loadBlogPosts();
            }
        }

        function loadSavedSection() {
            const savedSection = localStorage.getItem('activeSection') || 'home';
            const validSections = ['home', 'rescue', 'blog'];
            if (validSections.includes(savedSection)) {
                showSection(savedSection);
                if (savedSection === 'blog') loadBlogPosts();
            } else {
                showSection('home');
            }
        }

        async function loadBlogPosts() {
            const blogPostsContainer = document.getElementById('blog-posts');
            const currentLang = document.documentElement.lang || 'fa';
            blogPostsContainer.innerHTML = `<p><span lang="fa">در حال بارگذاری پست‌ها...</span><span lang="en" style="display:none">Loading posts...</span><span lang="ar" style="display:none">جارٍ تحميل المنشورات...</span><span lang="zh" style="display:none">正在加载帖子...</span><span lang="ru" style="display:none">Загрузка постов...</span><span lang="tr" style="display:none">Gönderiler yükleniyor...</span></p>`;
            if (blogPostsCache && currentLang === 'fa') {
                blogPostsContainer.innerHTML = blogPostsCache;
                return;
            }
            const feedUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://hpip.blogspot.com/feeds/posts/default');
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                const response = await fetch(feedUrl, { signal: controller.signal });
                clearTimeout(timeoutId);
                const data = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data, 'text/xml');
                const entries = xmlDoc.getElementsByTagName('entry');
                if (entries.length === 0) {
                    blogPostsContainer.innerHTML = '<p><span lang="fa">پستی برای نمایش وجود ندارد.</span><span lang="en" style="display:none">No posts to display.</span><span lang="ar" style="display:none">لا توجد منشورات للعرض.</span><span lang="zh" style="display:none">没有帖子可显示。</span><span lang="ru" style="display:none">Нет постов для отображения.</span><span lang="tr" style="display:none">Gösterilecek gönderi yok.</span></p>';
                    return;
                }
                blogPostsContainer.innerHTML = '';
                for (let i = 0; i < entries.length; i++) {
                    const entry = entries[i];
                    const title = entry.getElementsByTagName('title')[0].textContent;
                    const content = entry.getElementsByTagName('content')[0].textContent.replace(/<[^>]+>/g, '');
                    const link = Array.from(entry.getElementsByTagName('link'))
                        .find(link => link.getAttribute('rel') === 'alternate')
                        ?.getAttribute('href') || 'https://tigo.freeamoozesh63.workers.dev';
                    let translatedTitle = title;
                    let translatedContent = content;
                    let continueText = 'ادامه مطلب';
                    if (currentLang !== 'fa') {
                        translatedTitle = await translateText(title, 'fa', currentLang);
                        translatedContent = await translateText(content, 'fa', currentLang);
                        continueText = await translateText('ادامه مطلب', 'fa', currentLang);
                    }
                    const postDiv = document.createElement('div');
                    postDiv.className = 'blog-post';
                    postDiv.innerHTML = `
                        <h2><a href="${link}" target="_blank">${translatedTitle}</a></h2>
                        <p>${translatedContent.substring(0, 200)}... <a href="${link}" target="_blank">${continueText}</a></p>
                    `;
                    blogPostsContainer.appendChild(postDiv);
                }
                if (currentLang === 'fa') blogPostsCache = blogPostsContainer.innerHTML;
            } catch (error) {
                console.error('خطا در دریافت فید: ', error);
                const errorMsg = await translateText('فکر کنم اینترنتت اختلال داره نتونست محتوا رو بارگیری کنه، صفحه رو رفرش کن', 'fa', currentLang);
                blogPostsContainer.innerHTML = `<p>${errorMsg}</p>`;
            }
        }

        async function translateText(text, fromLang, toLang) {
            if (fromLang === toLang) return text;
            try {
                const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${fromLang}&tl=${toLang}&dt=t&q=${encodeURIComponent(text)}`);
                const data = await response.json();
                return data[0][0][0];
            } catch (error) {
                console.error('خطا در ترجمه: ', error);
                return text;
            }
        }

        function changeTheme(theme) {
            const root = document.documentElement;
            switch(theme) {
                case 'default':
                    root.style.setProperty('--bg-color', '#ffffff');
                    root.style.setProperty('--text-color', '#333');
                    root.style.setProperty('--nav-bg', '#d3d3d3');
                    root.style.setProperty('--link-color', '#007bff');
                    break;
                case 'theme1':
                    root.style.setProperty('--bg-color', '#F4EDEA');
                    root.style.setProperty('--text-color', '#5D576B');
                    root.style.setProperty('--nav-bg', '#D8E2DC');
                    root.style.setProperty('--link-color', '#5D576B');
                    break;
                case 'theme2':
                    root.style.setProperty('--bg-color', '#FFD7BA');
                    root.style.setProperty('--text-color', '#5F0F40');
                    root.style.setProperty('--nav-bg', '#FFB4A2');
                    root.style.setProperty('--link-color', '#5F0F40');
                    break;
                case 'theme3':
                    root.style.setProperty('--bg-color', '#ECF4D6');
                    root.style.setProperty('--text-color', '#265073');
                    root.style.setProperty('--nav-bg', '#9AD0C2');
                    root.style.setProperty('--link-color', '#265073');
                    break;
                case 'theme4':
                    root.style.setProperty('--bg-color', '#E0F2E9');
                    root.style.setProperty('--text-color', '#1A3C34');
                    root.style.setProperty('--nav-bg', '#A4C3B2');
                    root.style.setProperty('--link-color', '#1A3C34');
                    break;
            }
            localStorage.setItem('selectedTheme', theme);
        }

        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            changeTheme(savedTheme);
            document.getElementById('theme-select').value = savedTheme;
        }

        function loadSavedLanguage() {
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'fa';
            document.documentElement.lang = savedLanguage;
            document.querySelector('.language-menu select').value = savedLanguage;
            changeLanguage(savedLanguage);
        }

        function toggleAccordion(header) {
            const accordion = header.parentElement;
            const isActive = accordion.classList.contains('active');
            document.querySelectorAll('.accordion').forEach(acc => {
                acc.classList.remove('active');
            });
            if (!isActive) {
                accordion.classList.add('active');
            }
        }

        window.onload = function() {
            loadSavedTheme();
            loadSavedLanguage();
            loadSavedSection();
        };

        window.onhashchange = loadSectionFromHash;
    </script>
</body>
</html>
